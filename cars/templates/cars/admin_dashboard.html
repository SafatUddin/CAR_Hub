<!DOCTYPE html>
{% extends 'cars/base.html' %}

{% block content %}
<div class="card" style="max-width: 1200px; margin: 0 auto;">
    <h2 style="display: flex; align-items: center; gap: 0.5rem;">
        <i class="fa-solid fa-gauge-high"></i> Admin Dashboard
    </h2>
    
    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 0.5rem;">
            <h3 style="font-size: 2rem; margin: 0;">{{ total_users }}</h3>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Total Users</p>
        </div>
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 1.5rem; border-radius: 0.5rem;">
            <h3 style="font-size: 2rem; margin: 0;">{{ total_cars }}</h3>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Total Listings</p>
        </div>
        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 1.5rem; border-radius: 0.5rem;">
            <h3 style="font-size: 2rem; margin: 0;">{{ available_cars }}</h3>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Available Cars</p>
        </div>
        <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); padding: 1.5rem; border-radius: 0.5rem;">
            <h3 style="font-size: 2rem; margin: 0;">{{ sold_cars }}</h3>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Sold Cars</p>
        </div>
        <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); padding: 1.5rem; border-radius: 0.5rem;">
            <h3 style="font-size: 2rem; margin: 0;">{{ pending_orders }}</h3>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Pending Orders</p>
        </div>
    </div>

    <!-- Recent Users -->
    <div style="margin-bottom: 2rem;">
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <i class="fa-solid fa-users"></i> Recent Users
        </h3>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.05); border-bottom: 2px solid var(--glass-border);">
                        <th style="padding: 1rem; text-align: left;">Name</th>
                        <th style="padding: 1rem; text-align: left;">Email</th>
                        <th style="padding: 1rem; text-align: left;">Username</th>
                        <th style="padding: 1rem; text-align: left;">Joined</th>
                        <th style="padding: 1rem; text-align: left;">Listings</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_data in recent_users %}
                    <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem;">{{ user_data.user.first_name }} {{ user_data.user.last_name }}</td>
                        <td style="padding: 1rem;">{{ user_data.user.email }}</td>
                        <td style="padding: 1rem;">{{ user_data.user.username }}</td>
                        <td style="padding: 1rem;">{{ user_data.user.date_joined|date:"M d, Y" }}</td>
                        <td style="padding: 1rem;">{{ user_data.car_count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="padding: 1rem; text-align: center; color: #94a3b8;">No users found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recent Car Listings -->
    <div style="margin-bottom: 2rem;">
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <i class="fa-solid fa-car"></i> Recent Car Listings
        </h3>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.05); border-bottom: 2px solid var(--glass-border);">
                        <th style="padding: 1rem; text-align: left;">Car</th>
                        <th style="padding: 1rem; text-align: left;">Owner</th>
                        <th style="padding: 1rem; text-align: left;">Price (BDT)</th>
                        <th style="padding: 1rem; text-align: left;">Status</th>
                        <th style="padding: 1rem; text-align: left;">Decision</th>
                        <th style="padding: 1rem; text-align: left;">Listed</th>
                        <th style="padding: 1rem; text-align: left;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for car in recent_cars %}
                    <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem;">{{ car.year }} {{ car.make }} {{ car.model }}</td>
                        <td style="padding: 1rem;">{{ car.owner.username }}</td>
                        <td style="padding: 1rem;">à§³{{ car.price|floatformat:0 }}</td>
                        <td style="padding: 1rem;">
                            {% if car.status == 'available' %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #10b981; color: white;">
                                {{ car.status|title }}
                            </span>
                            {% else %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #64748b; color: white;">
                                {{ car.status|title }}
                            </span>
                            {% endif %}
                        </td>
                        <td style="padding: 1rem;">
                            {% if car.approval_status == 'approved' %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #10b981; color: white;">
                                Approved
                            </span>
                            {% elif car.approval_status == 'rejected' %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #ef4444; color: white;">
                                Rejected
                            </span>
                            {% else %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #f59e0b; color: white;">
                                Pending
                            </span>
                            {% endif %}
                        </td>
                        <td style="padding: 1rem;">{{ car.created_at|date:"M d, Y" }}</td>
                        <td style="padding: 1rem;">
                            <a href="{% url 'car_detail' car.id %}" class="btn" style="background: var(--primary-color); padding: 0.5rem 1rem; font-size: 0.9rem; display: inline-block;">View</a>
                            <a href="{% url 'delete_car' car.id %}" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem; display: inline-block; margin-left: 0.5rem;" onclick="return confirm('Are you sure you want to delete this car listing?')">Delete</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" style="padding: 1rem; text-align: center; color: #94a3b8;">No car listings found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- All Orders -->
    <div>
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <i class="fa-solid fa-receipt"></i> Recent Orders
        </h3>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.05); border-bottom: 2px solid var(--glass-border);">
                        <th style="padding: 1rem; text-align: left;">Order ID</th>
                        <th style="padding: 1rem; text-align: left;">Car</th>
                        <th style="padding: 1rem; text-align: left;">Buyer</th>
                        <th style="padding: 1rem; text-align: left;">Seller</th>
                        <th style="padding: 1rem; text-align: left;">Status</th>
                        <th style="padding: 1rem; text-align: left;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                    <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem;">#{{ order.id }}</td>
                        <td style="padding: 1rem;">{{ order.car.year }} {{ order.car.make }} {{ order.car.model }}</td>
                        <td style="padding: 1rem;">{{ order.buyer.username }}</td>
                        <td style="padding: 1rem;">{{ order.car.owner.username }}</td>
                        <td style="padding: 1rem;">
                            {% if order.status == 'pending' %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #f59e0b; color: white;">
                                {{ order.status|title }}
                            </span>
                            {% elif order.status == 'completed' %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #10b981; color: white;">
                                {{ order.status|title }}
                            </span>
                            {% else %}
                            <span style="padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.9rem; background: #ef4444; color: white;">
                                {{ order.status|title }}
                            </span>
                            {% endif %}
                        </td>
                        <td style="padding: 1rem;">{{ order.created_at|date:"M d, Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="padding: 1rem; text-align: center; color: #94a3b8;">No orders found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
