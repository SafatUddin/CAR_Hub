{% extends 'cars/base.html' %}

{% block content %}
<div class="card" style="max-width: 900px; margin: 0 auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
        <h2 style="margin:0;">Notifications</h2>
        {% if unread_count > 0 %}
        <form action="{% url 'mark_all_read' %}" method="post" style="margin:0;">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">
                <i class="fa-solid fa-check-double"></i> Mark All as Read
            </button>
        </form>
        {% endif %}
    </div>

    <div style="display:flex; flex-direction:column; gap:1rem;">
        {% for notif in notifications %}
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom: 1rem;">
                <div style="flex:1;">
                    <p style="margin:0; white-space: pre-line;">{{ notif.message }}</p>
                    <small style="color:#94a3b8;">{{ notif.created_at|timesince }} ago</small>
                </div>http://127.0.0.1:8000
                {% if not notif.is_read %}
                <span
                    style="background:#3b82f6; color:white; padding:0.25rem 0.5rem; border-radius:0.25rem; font-size:0.75rem; font-weight:600;">
                    NEW
                </span>
                {% endif %}
            </div>
            
            {% if 'rejected and removed by admin' in notif.message %}
            <div style="padding-top: 1rem; border-top: 1px solid var(--glass-border);">
                <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem; font-weight: 600; color: #94a3b8;">Contact Admin:</p>
                <div style="display: flex; gap: 1rem;">
                    {% if admin_email %}
                    <a href="mailto:{{ admin_email }}" class="btn"
                        style="background:white; color:black; display:flex; align-items:center; gap:0.5rem; font-size:0.9rem;">
                        <i class="fa-solid fa-envelope"></i> Email Admin
                    </a>
                    {% endif %}
                    {% if admin_whatsapp %}
                    <a href="https://wa.me/{{ admin_whatsapp }}" target="_blank" class="btn"
                        style="background:white; color:black; display:flex; align-items:center; gap:0.5rem; font-size:0.9rem;">
                        <i class="fa-brands fa-whatsapp"></i> WhatsApp Admin
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p style="text-align:center; color:#94a3b8; padding:2rem;">No notifications.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}